\subsection{R interface to
X-13ARIMA-SEATS}\label{r-interface-to-x-13arima-seats}

\emph{seasonal} is an easy-to-use and full-featured R-interface to
X-13ARIMA-SEATS, the newest seasonal adjustment software developed by
the \href{http://www.census.gov/srd/www/x13as/}{United States Census
Bureau}. X-13ARIMA-SEATS combines and extends the capabilities of the
older X-12ARIMA (developed by the Census Bureau) and TRAMO-SEATS
(developed by the Bank of Spain).

If you are new to seasonal adjustment or X-13ARIMA-SEATS, the automated
procedures of \emph{seasonal} allow you to quickly produce good seasonal
adjustments of time series. Start with the
\hyperref[installation]{Installation} and
\hyperref[getting-started]{Getting started} section and skip the rest.
Alternatively, \texttt{demo(seas)} gives an overview of the package
functionality.

If you are familiar with X-13ARIMA-SEATS, you may benefit from the
flexible input and output structure of \emph{seasonal}. The package
allows you to use (almost) all commands of X-13ARIMA-SEATS, and it can
import (almost) all output generated by X-13ARIMA-SEATS. The only
exception is the `composite' spec, which is not supported. Read the
\hyperref[input]{Input} and \hyperref[output]{Output} sections and have
a look at the
\href{https://github.com/christophsax/seasonal/wiki/Examples-of-X-13ARIMA-SEATS-in-R}{wiki},
where the examples from the official X-13ARIMA-SEATS
\href{http://www.census.gov/ts/x13as/docX13AS.pdf}{manual} are
reproduced in R.

\hyperdef{}{installation}{\subsubsection{Installation}\label{installation}}

To install the latest development version with support for the
\textbf{HTML version of X-13} and a new \textbf{Shiny-based graphical
user interface} directly from Github, type to the R console:

\begin{verbatim}
install.packages("devtools")
devtools::install_github('seasonal', 'christophsax')
\end{verbatim}

The stable version (0.6) is available from CRAN:

\begin{verbatim}
install.packages("seasonal")
\end{verbatim}

\emph{seasonal} does not include the binary executables of
X-13ARIMA-SEATS. They can be obtained precompiled from
\href{http://www.census.gov/srd/www/x13as/x13down_pc.html}{here}
(Windows: \texttt{x13ashtmlall.zip}). A guide on how to build it from
source for Ubuntu or Mac OS-X can be found
\href{http://askubuntu.com/questions/444354/how-do-i-install-x13-arima-seats-for-rstudio-from-source}{here}.
My own compilation for Mac OS-X can be obtained
\href{mailto:christoph.sax@gmail.com}{upon request}.

Download the file, unzip it and copy \texttt{x13ashtml.exe} (or
\texttt{x13ashtml}, on a Unix system) to the desired location in your
file system. Next, you need to tell \emph{seasonal} where to find the
binary executables of X-13ARIMA-SEATS, by setting the specific
environmental variable \texttt{X13\_PATH}. This may be done during your
active session in R:

\begin{verbatim}
Sys.setenv(X13_PATH = "YOUR_X13_DIRECTORY")
\end{verbatim}

Exchange \texttt{YOUR\_X13\_DIRECTORY} with the path to your
installation of X-13ARIMA-SEATS. Note that the Windows path
\texttt{C:\textbackslash{}something\textbackslash{}somemore} has to be
entered UNIX-like \texttt{C:/something/somemore} or
\texttt{C:\textbackslash{}\textbackslash{}something\textbackslash{}\textbackslash{}somemore}.
You can always check your installation with:

\begin{verbatim}
checkX13()
\end{verbatim}

If you want to set the environmental variable permanently, you may do so
by adding it to the \texttt{Renviron.site} file, which is located in the
\texttt{etc} subdirectory of your R home directory (use
\texttt{R.home()} in R to reveal the home directory).
\texttt{Renviron.site} does not exist by default; if not, you have to
create a file named \texttt{Renviron.site} with your favorite text
editor (on Windows, be careful with the `show extensions for known file
types' option, the extension \texttt{.site} may be hidden). Add the
following line to the file (without quotes!):

\begin{verbatim}
X13_PATH = YOUR_PATH_TO_X13
\end{verbatim}

Alternatively, use the system terminal (on Windows, it's called command
prompt; also, the \texttt{cd} command requires \texttt{\textbackslash{}}
instead of \texttt{/}):

\begin{verbatim}
cd YOUR_R_HOME_DIRECTORY/etc
echo X13_PATH = YOUR_PATH_TO_X13 >> Renviron.site
\end{verbatim}

There are other ways to set an environmental variable permanently in R,
see \texttt{?Startup}.

\hyperdef{}{getting-started}{\subsubsection{Getting
started}\label{getting-started}}

\texttt{seas} is the core function of the \emph{seasonal} package. By
default, \texttt{seas} calls the automatic procedures of X-13ARIMA-SEATS
to perform a seasonal adjustment that works well in most circumstances:

\begin{verbatim}
m <- seas(AirPassengers)
 
\end{verbatim}

The first argument of \texttt{seas} has to be a time series of class
\texttt{"ts"}. The function returns an object of class \texttt{"seas"}
that contains all necessary information on the adjustment.

There are several functions and methods for \texttt{"seas"} objects: The
\texttt{final} function returns the adjusted series, the \texttt{plot}
method shows a plot with the unadjusted and the adjusted series. The
\texttt{summary} method allows you to display an overview of the model:

\begin{verbatim}
final(m)
plot(m)
summary(m)
\end{verbatim}

By default, \texttt{seas} calls the SEATS adjustment procedure. If you
prefer the X11 adjustment procedure, use the following option (see the
\hyperref[input]{Input} section for details on how to use arbitrary
options with X-13):

\begin{verbatim}
seas(AirPassengers, x11 = "")
\end{verbatim}

A default call to \texttt{seas} also invokes the following automatic
procedures of X-13ARIMA-SEATS:

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Transformation selection (log / no log)
\item
  Detection of trading day and Easter effects
\item
  Outlier detection
\item
  ARIMA model search
\end{itemize}

Alternatively, all inputs may be entered manually, as in the following
example:

\begin{verbatim}
seas(x = AirPassengers, 
     regression.variables = c("td1coef", "easter[1]", "ao1951.May"), 
     arima.model = "(0 1 1)(0 1 1)", 
     regression.aictest = NULL,
     outlier = NULL, 
     transform.function = "log")
\end{verbatim}

The \texttt{static} command returns the manual call of a model. The call
above can be easily generated from the automatic model:

\begin{verbatim}
static(m)
static(m, coef = TRUE)  # also fixes the coefficients
\end{verbatim}

If you have \emph{Shiny} installed, the \texttt{inspect} command offers
a way to analyze and modify a seasonal adjustment procedure (see the
section below for details):

\begin{verbatim}
inspect(m)
\end{verbatim}

\hyperdef{}{input}{\subsubsection{Input}\label{input}}

In \emph{seasonal}, it is possible to use almost the complete syntax of
X-13ARIMA-SEATS. This is done via the \texttt{...} argument in the
\texttt{seas} function. The X-13ARIMA-SEATS syntax uses \emph{specs} and
\emph{arguments}, with each spec optionally containing some arguments.
These spec-argument combinations can be added to \texttt{seas} by
separating the spec and the argument by a dot (\texttt{.}). For example,
in order to set the `variables' argument of the `regression' spec equal
to \texttt{td} and \texttt{ao1999.jan}, the input to \texttt{seas} looks
like this:

\begin{verbatim}
m <- seas(AirPassengers, regression.variables = c("td", "ao1955.jan"))
\end{verbatim}

Note that R vectors may be used as an input. If a spec is added without
any arguments, the spec should be set equal to an empty string (or,
alternatively, to an empty list). Several defaults of \texttt{seas} are
empty strings, such as the default \texttt{seats = ""}. See the help
page (\texttt{?seas}) for more details on the defaults. Note the
difference between \texttt{""} (meaning the spec is enabled but has no
arguments) and \texttt{NULL} (meaning the spec is disabled).

It is possible to manipulate almost all inputs to X-13ARIMA-SEATS in
this way. For instance, example 1 in section 7.1 from the
\href{http://www.census.gov/ts/x13as/docX13AS.pdf}{manual},

\begin{verbatim}
series { title  =  "Quarterly Grape Harvest" start = 1950.1
       period =  4
       data  = (8997 9401 ... 11346) }
arima { model = (0 1 1) }
estimate { }
\end{verbatim}

translates to R in the following way:

\begin{verbatim}
seas(AirPassengers,
     x11 = ""),
     arima.model = "(0 1 1)"
)
\end{verbatim}

\texttt{seas} takes care of the `series' spec, and no input beside the
time series has to be provided. As \texttt{seas} uses the SEATS
procedure by default, the use of X11 has to be specified manually. When
the `x11' spec is added as an input (like above), the mutually exclusive
and default `seats' spec is automatically disabled. With
\texttt{arima.model}, an additional spec-argument is added to the input
of X-13ARIMA-SEATS. As the spec cannot be used in the same call as the
`automdl' spec, the latter is automatically disabled. The best way to
learn about the relationship between the syntax of X-13ARIMA-SEATS and
\emph{seasonal} is to study the comprehensive list of examples in the
\href{https://github.com/christophsax/seasonal/wiki/Examples-of-X-13ARIMA-SEATS-in-R}{wiki}.

There are some mutually exclusive specs in X-13ARIMA-SEATS. If more than
one mutually exclusive spec is included in \texttt{seas}, specs are
overwritten according the following priority rules:

\begin{itemize}
\itemsep1pt\parskip0pt\parsep0pt
\item
  Model selection

  \begin{enumerate}
  \def\labelenumi{\arabic{enumi}.}
  \itemsep1pt\parskip0pt\parsep0pt
  \item
    \texttt{arima}
  \item
    \texttt{pickmdl}
  \item
    \texttt{automdl} (default)
  \end{enumerate}
\item
  Adjustment procedure

  \begin{enumerate}
  \def\labelenumi{\arabic{enumi}.}
  \itemsep1pt\parskip0pt\parsep0pt
  \item
    \texttt{x11}
  \item
    \texttt{seats} (default)
  \end{enumerate}
\end{itemize}

\hyperdef{}{output}{\subsubsection{Output}\label{output}}

\emph{seasonal} has a flexible mechanism to read data from
X-13ARIMA-SEATS. With the \texttt{series} function, it is possible to
import almost all output that can be generated by X-13ARIMA-SEATS. For
example, the following command returns the forecasts of the ARIMA model
as a \texttt{"ts"} time series:

\begin{verbatim}
m <- seas(AirPassengers)
series(m, "forecast.forecasts")
\end{verbatim}

Because the \texttt{forecast.save = "forecasts"} argument has not been
specified in the model call, \texttt{series} re-evaluates the call with
the `forecast' spec enabled. It is also possible to return more than one
output table at the same time:

\begin{verbatim}
series(m, c("forecast.forecasts", "d1"))
\end{verbatim}

You can use either the unique short names of X-13 (such as \texttt{d1}),
or the the long names (such as \texttt{forecasts}). Because the long
table names are not unique, they need to be combined with the spec name
(\texttt{forecast}). See \texttt{?series} for a complete list of
options.

Note that re-evaluation doubles the overall computation time. If you
want to speed it up, you have to be explicit about the output in the
model call:

\begin{verbatim}
m <- seas(AirPassengers, forecast.save = "forecasts")
series(m, "forecast.forecasts")
\end{verbatim}

Some specs, like `slidingspans' and `history', are time consuming.
Re-evaluation allows you to separate these specs from the basic model
call:

\begin{verbatim}
m <- seas(AirPassengers)
series(m, "history.saestimates")
series(m, "slidingspans.sfspans")
\end{verbatim}

If you are using the HTML version of X-13, the \texttt{out} function
shows the content of the main output in the browser:

\begin{verbatim}
out(m)
\end{verbatim}

\subsubsection{Graphs}\label{graphs}

There are several graphical tools to analyze a \texttt{seas} model. The
main plot function draws the seasonally adjusted and unadjusted series,
as well as the outliers. Optionally, it also draws the trend of the
seasonal decomposition:

\begin{verbatim}
m <- seas(AirPassengers, regression.aictest = c("td", "easter"))
plot(m)
plot(m, outliers = FALSE)
plot(m, trend = TRUE)
\end{verbatim}

The \texttt{monthplot} function allows for a monthwise plot (or
quarterwise, with the same function name) of the seasonal and the SI
component:

\begin{verbatim}
monthplot(m)
monthplot(m, choice = "irregular")
\end{verbatim}

Also, many standard R function can be used to analyze a \texttt{"seas"}
model:

\begin{verbatim}
pacf(resid(m))
spectrum(diff(resid(m)))
plot(density(resid(m)))
qqnorm(resid(m))
\end{verbatim}

The \texttt{identify} method can be used to select or deselect outliers
by point and click. Click several times to loop through different
outlier types.

\begin{verbatim}
identify(m)
\end{verbatim}

\subsubsection{Inspect tool}\label{inspect-tool}

The \texttt{inspect} function is a graphical tool for choosing a
seasonal adjustment model. Since seasonal 0.62, it uses \emph{Shiny} and
can now be used without RStudio. To install the latest version of Shiny,
type:

\begin{verbatim}
install.packages("shiny")
\end{verbatim}

The goal of \texttt{inspect} is to summarize all relevant options, plots
and statistics that should be usually considered. \texttt{inspect} uses
a \texttt{"seas"} object as its only argument:

\begin{verbatim}
inspect(m)
\end{verbatim}

The \texttt{inspect} function opens an interactive window that allows
for the manipulation of a number of arguments. It offers several views
to analyze the series graphically. With each change, the adjustment
process and the visualizations are recalculated. Summary statistics are
shown in the first tab. The last tab offers access to all series that
can be produced with X-13. The views in \texttt{inspect} are also
customizable, see the examples in \texttt{?inspect}.

\subsubsection{License}\label{license}

\emph{seasonal} is free and open source, licensed under GPL-3. It has
been developed for the use at the Swiss State Secretariat of Economic
Affairs. Its development is not connected to the development of
X-13ARIMA-SEATS
(\href{https://www.census.gov/srd/www/disclaimer.html}{license}).

Please report bugs and suggestions on
\href{https://github.com/christophsax/seasonal}{Github} or send me an
\href{mailto:christoph.sax@gmail.com}{e-mail}. Thank you!
